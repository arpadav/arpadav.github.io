<!doctype html><meta content="text/html; charset=utf-8"charset=utf-8 http-equiv=Content-Type><title>20241208-wake-on-lan.md - Arpad Voros</title><link href=/images/site.webmanifest rel=manifest><link href=/images/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/images/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/images/apple-touch-icon.png rel=apple-touch-icon sizes=180x180></head><div class=sidebar id=sidebar><li><a href=/gator/ target=_parent> <img style="width: 268px;"src=/images/alligator.png> </a></div><div class=beside-sidebar><div class=navbar id=navbar><ul><li><a href=/# target=_parent>home</a><li><a href=/#about target=_parent>about</a><li><a href=/#contact target=_parent>contact</a><li><a href=/#socials target=_parent>socials</a><li><a href=/cv.pdf target=_parent>cv</a><li><a href=/projects target=_parent>projects</a><li><a href=/notes target=_parent>notes</a></ul></div></div><div id=markdown-content><style>#markdown-content h1 {
            margin-top: 0%;
        }
        #markdown-content img {
            max-width: 50vw;
            max-height: 70vh;
            margin: 0 auto;
            display: block;
            object-fit: contain;
        }</style><style>code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */</style><link href=/css/std.css rel=stylesheet><body><h1 id=wake-on-lan-linux>Wake-on-Lan (Linux)</h1><h2 id=on-device-that-needs-to-be-remotely-woken>On device that needs to be remotely woken</h2><h3 id=requirements>Requirements</h3><div class=sourceCode id=cb1><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb1-1><a aria-hidden=true href=#cb1-1 tabindex=-1></a><span class=fu>sudo</span> apt install ethtool</span></code></pre></div><h3 id=setup>Setup</h3><ol type=1><li><p>See network interfaces (NIC's)</p> <div class=sourceCode id=cb2><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb2-1><a aria-hidden=true href=#cb2-1 tabindex=-1></a><span class=ex>ip</span> link show</span></code></pre></div> <p>Select the default one (state up, not loop back, usually <code>eth0</code>, <code>eth1</code>, etc.)<li><p>See WoL status</p> <div class=sourceCode id=cb3><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb3-1><a aria-hidden=true href=#cb3-1 tabindex=-1></a><span class=fu>sudo</span> ethtool <span class=op><</span>NETWORK-DEVICE-NAME<span class=op>></span></span></code></pre></div> <ul><li>If <code>Supports Wake-on</code> has a <code>g</code> character, then it is supported.<li>If it does not, then you can swiftly <strong>exit this tutorial, as you can not wake-on-LAN the device you want to :(</strong></ul> <p>See if <code>Wake-on</code> is <code>g</code>. It can be any of the following:</p> <p><em>Source: <a href=https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/6/html/deployment_guide/s1-ethtool#idm140653496737808>https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/6/html/deployment_guide/s1-ethtool</a></em></p> <ul><li><code>p</code> — Wake on PHY activity.<li><code>u</code> — Wake on unicast messages.<li><code>m</code> — Wake on multicast messages.<li><code>b</code> — Wake on broadcast messages.<li><code>g</code> — Wake-on-Lan; wake on receipt of a "magic packet".<li><code>s</code> — Enable security function using password for Wake-on-Lan.<li><code>d</code> — Disable Wake-on-Lan and clear all settings.</ul> <p>If not <code>g</code>, then run the following to set it:</p> <div class=sourceCode id=cb4><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb4-1><a aria-hidden=true href=#cb4-1 tabindex=-1></a><span class=fu>sudo</span> ethtool <span class=at>-s</span> <span class=op><</span>NETWORK-DEVICE-NAME<span class=op>></span> wol g</span></code></pre></div><li><p>Set WoL status every-time on boot to <code>g</code></p> <p><code>/etc/systemd/system/wol.service</code>:</p> <div class=sourceCode id=cb5><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb5-1><a aria-hidden=true href=#cb5-1 tabindex=-1></a><span class=ex>[Unit]</span></span>
<span id=cb5-2><a aria-hidden=true href=#cb5-2 tabindex=-1></a><span class=va>Description</span><span class=op>=</span>Enable <span class=ex>Wake-on-LAN</span></span>
<span id=cb5-3><a aria-hidden=true href=#cb5-3 tabindex=-1></a><span class=va>Wants</span><span class=op>=</span>network-online.target</span>
<span id=cb5-4><a aria-hidden=true href=#cb5-4 tabindex=-1></a><span class=va>After</span><span class=op>=</span>network.target <span class=ex>network-online.target</span> <span class=co># &LT-- `network.target` is optional, backwards compatibility</span></span>
<span id=cb5-5><a aria-hidden=true href=#cb5-5 tabindex=-1></a></span>
<span id=cb5-6><a aria-hidden=true href=#cb5-6 tabindex=-1></a><span class=ex>[Service]</span></span>
<span id=cb5-7><a aria-hidden=true href=#cb5-7 tabindex=-1></a><span class=va>Type</span><span class=op>=</span>oneshot</span>
<span id=cb5-8><a aria-hidden=true href=#cb5-8 tabindex=-1></a><span class=va>ExecStart</span><span class=op>=</span>/usr/bin/sudo <span class=ex>/usr/local/bin/set-wol.sh</span></span>
<span id=cb5-9><a aria-hidden=true href=#cb5-9 tabindex=-1></a><span class=va>User</span><span class=op>=</span>root</span>
<span id=cb5-10><a aria-hidden=true href=#cb5-10 tabindex=-1></a></span>
<span id=cb5-11><a aria-hidden=true href=#cb5-11 tabindex=-1></a><span class=ex>[Install]</span></span>
<span id=cb5-12><a aria-hidden=true href=#cb5-12 tabindex=-1></a><span class=va>WantedBy</span><span class=op>=</span>multi-user.target</span></code></pre></div> <p><code>/usr/local/bin/set-wol.sh</code>:</p> <div class=sourceCode id=cb6><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb6-1><a aria-hidden=true href=#cb6-1 tabindex=-1></a><span class=co>#!/bin/bash</span></span>
<span id=cb6-2><a aria-hidden=true href=#cb6-2 tabindex=-1></a></span>
<span id=cb6-3><a aria-hidden=true href=#cb6-3 tabindex=-1></a><span class=va>DEV</span><span class=op>=<</span>NETWORK-DEVICE-NAME<span class=op>></span></span>
<span id=cb6-4><a aria-hidden=true href=#cb6-4 tabindex=-1></a><span class=va>SLEEP_S</span><span class=op>=</span>10</span>
<span id=cb6-5><a aria-hidden=true href=#cb6-5 tabindex=-1></a><span class=va>MAX_RETRIES</span><span class=op>=</span>50</span>
<span id=cb6-6><a aria-hidden=true href=#cb6-6 tabindex=-1></a><span class=va>RETRY_COUNT</span><span class=op>=</span>0</span>
<span id=cb6-7><a aria-hidden=true href=#cb6-7 tabindex=-1></a></span>
<span id=cb6-8><a aria-hidden=true href=#cb6-8 tabindex=-1></a><span class=cf>while</span> <span class=ot>! </span><span class=ex>ip</span> link show <span class=va>$DEV</span> <span class=kw>|</span> <span class=fu>grep</span> <span class=at>-q</span> <span class=st>"state UP"</span> <span class=kw>&&</span> <span class=bu>[</span> <span class=va>$RETRY_COUNT</span> <span class=ot>-lt</span> <span class=va>$MAX_RETRIES</span> <span class=bu>]</span><span class=kw>;</span> <span class=cf>do</span></span>
<span id=cb6-9><a aria-hidden=true href=#cb6-9 tabindex=-1></a>    <span class=fu>sleep</span> <span class=va>$SLEEP_S</span></span>
<span id=cb6-10><a aria-hidden=true href=#cb6-10 tabindex=-1></a>    <span class=kw>((</span><span class=va>RETRY_COUNT</span><span class=op>++</span><span class=kw>))</span></span>
<span id=cb6-11><a aria-hidden=true href=#cb6-11 tabindex=-1></a><span class=cf>done</span></span>
<span id=cb6-12><a aria-hidden=true href=#cb6-12 tabindex=-1></a></span>
<span id=cb6-13><a aria-hidden=true href=#cb6-13 tabindex=-1></a><span class=cf>if</span> <span class=ex>ip</span> link show <span class=va>$DEV</span> <span class=kw>|</span> <span class=fu>grep</span> <span class=at>-q</span> <span class=st>"state UP"</span><span class=kw>;</span> <span class=cf>then</span></span>
<span id=cb6-14><a aria-hidden=true href=#cb6-14 tabindex=-1></a>    <span class=ex>/usr/bin/sudo</span> /usr/sbin/ethtool <span class=at>-s</span> <span class=va>$DEV</span> wol g</span>
<span id=cb6-15><a aria-hidden=true href=#cb6-15 tabindex=-1></a><span class=cf>else</span></span>
<span id=cb6-16><a aria-hidden=true href=#cb6-16 tabindex=-1></a>    <span class=bu>echo</span> <span class=st>"Failed to bring up </span><span class=va>$DEV</span><span class=st> after </span><span class=va>$MAX_RETRIES</span><span class=st> attempts."</span></span>
<span id=cb6-17><a aria-hidden=true href=#cb6-17 tabindex=-1></a>    <span class=bu>exit</span> 1</span>
<span id=cb6-18><a aria-hidden=true href=#cb6-18 tabindex=-1></a><span class=cf>fi</span></span></code></pre></div> <p>Note: I tried to simply make the <code>ExecStart</code> in the systemd service: <code>/usr/bin/sudo /usr/sbin/ethtool -s &LTNETWORK-DEVICE-NAME> wol g</code>, but it didn't seem to work.</p> <p>It might come down to the NIC not being up yet, because of either 1. standard boot procedures or 2. disk decryption (which I have).</p> <p>Then, run the following to start the service:</p> <div class=sourceCode id=cb7><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb7-1><a aria-hidden=true href=#cb7-1 tabindex=-1></a><span class=fu>sudo</span> chmod +x /usr/local/bin/set-wol.sh</span>
<span id=cb7-2><a aria-hidden=true href=#cb7-2 tabindex=-1></a><span class=fu>sudo</span> systemctl daemon-reload</span>
<span id=cb7-3><a aria-hidden=true href=#cb7-3 tabindex=-1></a><span class=fu>sudo</span> systemctl enable wol.service</span>
<span id=cb7-4><a aria-hidden=true href=#cb7-4 tabindex=-1></a><span class=fu>sudo</span> systemctl start wol.service</span></code></pre></div> <p>Check <code>sudo systemctl status wol.service</code> and <code>sudo ethtool &LTNETWORK-DEVICE-NAME></code> to verify.<li><p>Get the MAC address of the device</p> <div class=sourceCode id=cb8><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb8-1><a aria-hidden=true href=#cb8-1 tabindex=-1></a><span class=ex>ip</span> addr show <span class=op><</span>NETWORK-DEVICE-NAME<span class=op>></span> <span class=kw>|</span> <span class=fu>grep</span> ether <span class=kw>|</span> <span class=fu>awk</span> <span class=st>'{print $2}'</span></span></code></pre></div> <p>Save this, since you will need this on all other LAN devices that need to magically boot this device.</ol><h2 id=on-device-that-wakes-remote-device>On device that wakes remote device</h2><h3 id=requirements-1>Requirements</h3><h4 id=linux>Linux</h4><div class=sourceCode id=cb9><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb9-1><a aria-hidden=true href=#cb9-1 tabindex=-1></a><span class=fu>sudo</span> apt install wakeonlan</span></code></pre></div><h4 id=windows>Windows</h4><div class=sourceCode id=cb10><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id=cb10-1><a aria-hidden=true href=#cb10-1 tabindex=-1></a>winget install <span class=op>--</span>id<span class=op>=</span>DarkfullDante<span class=op>.</span><span class=fu>wol</span>  <span class=op>-</span>e</span></code></pre></div><h3 id=setup-1>Setup</h3><h4 id=linux-1>Linux</h4><div class=sourceCode id=cb11><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb11-1><a aria-hidden=true href=#cb11-1 tabindex=-1></a><span class=ex>wakeonlan</span> <span class=op><</span>MAC-ADDRESS<span class=op>></span></span></code></pre></div><h4 id=windows-1>Windows</h4><div class=sourceCode id=cb12><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id=cb12-1><a aria-hidden=true href=#cb12-1 tabindex=-1></a>wol <span class=op>-</span>m <span class=st>"&LTMAC-ADDRESS>"</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Done! Can further automate this, e.g. making a powershell/bash script to automatically WoL + decrypt disk upon trying to SSH to the device, by mapping domain names to MAC addresses. But that is niche enough and fairly easy which is outside the scope of this note.</div><br>